# Gemini API Configuration Guide

## Overview

The application uses **direct Gemini API integration** for image generation. All images are generated by connecting directly to Google's Gemini API using environment variables configured in Vercel.

## Configuration

### Required Environment Variables

Set these in your Vercel project settings:

```bash
# Your Google Gemini API key from Google AI Studio
VITE_GEMINI_API_KEY=your_api_key_here
```

### Optional Environment Variables

```bash
# Gemini model to use (default: gemini-3-pro-image-preview)
VITE_GEMINI_MODEL=gemini-3-pro-image-preview

# Or use nanobanana if it's a custom model/endpoint
# VITE_GEMINI_MODEL=nanobanana

# API endpoint (default: Google's standard endpoint)
VITE_GEMINI_ENDPOINT=https://generativelanguage.googleapis.com/v1beta
```

## Getting a Gemini API Key

1. Go to [Google AI Studio](https://makersuite.google.com/app/apikey)
2. Sign in with your Google account
3. Create a new API key
4. Copy the key and add it to your Vercel environment variables

## Nanobanana Configuration

If "nanobanana" is a specific model or endpoint:

### Option 1: Custom Model Name
```bash
VITE_GEMINI_MODEL=nanobanana
VITE_GEMINI_API_KEY=your_api_key_here
```

### Option 2: Custom Endpoint
```bash
VITE_GEMINI_ENDPOINT=https://your-custom-endpoint.com/v1
VITE_GEMINI_MODEL=nanobanana
VITE_GEMINI_API_KEY=your_api_key_here
```

## Image Generation Features

### Automatic Style Enhancement

All generated images automatically include the following style:
```
photorealistic cinematic portrait, the lighting is natural and slightly 
underexposed, The image should look like real analog film photography, 
not CGI, not 3D, not cartoon, not glossy.
```

This is applied automatically via the prompt enhancement system in `src/lib/prompt-enhancement.ts`.

### Progress Tracking Elements

Images are generated with trackable elements that can be updated over time to show progress, such as:
- Books that can gain titles and change appearance
- Milestones that can be filled in
- Visual indicators of achievements

### Performance

- **Timeout**: 60 seconds maximum per image generation
- **Error Handling**: Graceful error messages with retry and skip options

## Troubleshooting

### Images not generating

1. **Check API Key**: Ensure `VITE_GEMINI_API_KEY` is set correctly in Vercel
2. **Check Permissions**: Verify your API key has image generation permissions
3. **Check Console**: Look for error messages in browser developer console
4. **Check Vercel**: Ensure environment variables are set and deployed

### Slow image generation

1. **Network**: Check your internet connection
2. **API Limits**: You may have hit rate limits (check Google Cloud Console)
3. **Timeout**: Images taking longer than 60 seconds will timeout with option to skip

### Nanobanana not working

1. **Verify Configuration**: Ensure the model name/endpoint is correct
2. **Check Environment Variables**: Verify `VITE_GEMINI_MODEL` is set correctly in Vercel
3. **Contact Admin**: If nanobanana is custom, contact your system administrator

## Testing

To test the configuration:

1. Start the development server: `npm run dev`
2. Go through onboarding to step 8 (image generation)
3. Check browser console for logs:
   - "Using Gemini API directly for image generation" = Direct API working
4. Verify image generates successfully

## Architecture

```
User Input → Prompt Enhancement → Gemini API Direct → Generated Image
```

The application uses a simplified architecture with direct API calls only.

## Files Modified

- `src/lib/gemini-api.ts`: Direct Gemini API integration
- `src/lib/webhooks.ts`: Simplified to use only direct Gemini API
- `src/lib/prompt-enhancement.ts`: Automatic style enhancement
- `src/components/onboarding/steps/GeneratingStep.tsx`: Uses enhanced prompts

## Support

For issues with:
- **Gemini API**: Check [Google AI documentation](https://ai.google.dev/docs)
- **Nanobanana**: Contact the system administrator who configured it
